webpackJsonp([1],{"2Gej":function(t,e){},"2bHb":function(t,e){},"4/hK":function(t,e){},"7WbU":function(t,e){},"991W":function(t,e){},"9xLI":function(t,e){},GWAM:function(t,e){},JhcL:function(t,e){},NHnr:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("mvHQ"),n=s.n(i),a=s("7+uW"),r=s("Dd8w"),o=s.n(r),c=s("NYxO"),l={formatDate:function(t,e){/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length)));var s={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds()};for(var i in s)if(new RegExp("("+i+")").test(e)){var n=s[i]+"";e=e.replace(RegExp.$1,1===RegExp.$1.length?n:function(t){return("00"+t).substr(t.length)}(n))}return e},setChartTypes:function(t){this.api.post("/chartType/find",{}).then(function(e){e.status&&t.$store.dispatch("setTypes",e.result)})},setProjects:function(t,e){t.api.post("/project/findByUser",{pageSize:100,userId:e}).then(function(e){e.status&&t.$store.dispatch("setProjects",e.result)})},getUrlData:function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),s=window.location.search.substr(1).match(e);return null!=s?unescape(s[2]):null},setLoginStore:function(t,e){t.$store.dispatch("setMenus",!0),t.$store.dispatch("setLoginDialogState",!1),t.$store.dispatch("setUser",e),this.setProjects(t,e._id)},message:function(t,e,s){t.$message({showClose:!0,message:s,type:e})}},u={name:"login",data:function(){return{flag:1,user:{name:"",pwd:""},error:{msg:"",show:!1}}},mounted:function(){},methods:{login:function(){var t=this;if(!this.user.name||!this.user.pwd)return this.error={msg:"用户名或密码不能为空",show:!0},void this.closeAlert();this.api.post("/user/find",this.user).then(function(e){e.result?(localStorage.setItem("currUser",n()(e.result)),l.setLoginStore(t,e.result)):(t.error={msg:"用户名或密码错误",show:!0},t.closeAlert())})},change:function(){this.flag=!this.flag},closeAlert:function(){var t=this;setTimeout(function(){t.error.show=!1},1500)},closeLogin:function(){this.$store.dispatch("setLoginDialogState",!1),this.$store.dispatch("setProjects",[])},githubClick:function(){window.location.href="https://github.com/login/oauth/authorize?client_id=263f45ba8ea1fb856276&redirect_uri="+window.location.href}}},d={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"block-login-wrap"},[t._m(0),t._v(" "),s("transition",{attrs:{name:"slide-fade"}},[t.flag?s("div",{staticClass:"login-con"},[s("div",{staticClass:"login-choose"},[s("span",[t._v("请选择快捷登录方式")])]),t._v(" "),s("div",{staticClass:"login-div"},[s("ul",{staticClass:"clearfix"},[s("li",[s("a",{on:{click:t.githubClick}},[s("i",{staticClass:"icon iconfont icon-github"})])]),t._v(" "),s("li",[s("a",[s("i",{staticClass:"icon iconfont icon-qqfuben"})])])])])]):t._e()]),t._v(" "),s("transition",{attrs:{name:"slide-fade"}},[t.flag?t._e():s("div",{staticClass:"login-con"},[s("el-form",{attrs:{model:t.user,"label-width":"80px",size:"small"}},[s("el-form-item",{attrs:{label:"用户名"}},[s("el-input",{staticClass:"inp",model:{value:t.user.name,callback:function(e){t.$set(t.user,"name",e)},expression:"user.name"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"密码"}},[s("div",{staticClass:"inp el-input el-input--small"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.user.pwd,expression:"user.pwd"}],staticClass:"el-input__inner",attrs:{type:"password"},domProps:{value:t.user.pwd},on:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.login(e)},input:function(e){e.target.composing||t.$set(t.user,"pwd",e.target.value)}}})])]),t._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:t.login}},[t._v("登录")]),t._v(" "),s("el-button",{on:{click:t.closeLogin}},[t._v("关闭")])],1)],1),t._v(" "),s("transition",{attrs:{name:"slide-fade-error"}},[t.error.show?s("el-alert",{attrs:{title:t.error.msg,type:"error",closable:!1,"show-icon":""}}):t._e()],1)],1)]),t._v(" "),s("div",{staticClass:"login-model"},[s("span",{on:{click:t.change}},[t._v(t._s(t.flag?"切换用户登录":"切换快捷登录"))])])],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"login-top"},[e("span",[this._v("图表融合平台")])])}]},h=s("VU/8")(u,d,!1,function(t){s("pQID")},"data-v-712bea0e",null).exports,p={name:"app",data:function(){return{}},computed:o()({},Object(c.b)({loginDialogState:"getIsShowLoginDialog"})),components:{LoginDialog:h},mounted:function(){this.init()},methods:{init:function(){},close:function(){this.$store.dispatch("setLoginDialogState",!1)}}},m={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[s("router-view"),t._v(" "),s("el-dialog",{attrs:{visible:t.loginDialogState,width:"340px","append-to-body":!0,"lock-scroll":!1},on:{"update:visible":function(e){t.loginDialogState=e},close:t.close}},[s("LoginDialog")],1)],1)},staticRenderFns:[]},f=s("VU/8")(p,m,!1,null,null,null).exports,v=s("/ocq"),g={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.key,expression:"key"}],attrs:{type:"text",placeholder:"请输入查询条件"},domProps:{value:t.key},on:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.search(e)},input:function(e){e.target.composing||(t.key=e.target.value)}}}),s("i",{staticClass:"icon iconfont icon-search",on:{click:t.search}})])},staticRenderFns:[]},_=s("VU/8")({name:"search",data:function(){return{key:""}},methods:{search:function(){this.key&&this.$router.push({path:"/chart/search",query:{q:this.key}})}}},g,!1,function(t){s("GWAM")},"data-v-52abe2c2",null).exports,b={name:"HeaderBar",computed:o()({},Object(c.b)({currMenu:"getCurrMenu",menus:"getMenus",isLogin:"getIsLogin"})),components:{Search:_},data:function(){return{}},mounted:function(){this.init()},methods:{init:function(){},login:function(){this.$store.dispatch("setLoginDialogState",!0)},exit:function(){localStorage.removeItem("currUser"),this.$router.push("/"),this.$store.dispatch("setMenus",!1),this.$store.dispatch("setUser",null)}}},C={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"navbar"},[s("div",{staticClass:"logo"},[s("router-link",{attrs:{to:"/"}},[s("i",{staticClass:"icon iconfont icon-icp-acitve-spline"}),s("span",[t._v("charts")])])],1),t._v(" "),s("ul",t._l(t.menus,function(e){return s("li",{class:[e.flag==t.currMenu.flag?"active":""]},[s("router-link",{attrs:{to:e.url}},[s("i",{class:["icon","iconfont",e.icon]}),t._v(t._s(e.name))])],1)})),t._v(" "),s("div",{staticClass:"block-bar-right"},[s("div",{staticClass:"search"},[s("Search")],1),t._v(" "),t.isLogin?t._e():s("div",{staticClass:"operation"},[s("div",{staticClass:"user"},[s("i",{staticClass:"icon iconfont icon-icon",on:{click:t.login}})])]),t._v(" "),t.isLogin?s("div",{staticClass:"operation",staticStyle:{width:"60px"}},[t._m(0),t._v(" "),s("div",{staticClass:"item"},[s("div",{staticClass:"usercenter"},[s("router-link",{attrs:{to:"/user"}},[t._v("个人中心")])],1),t._v(" "),s("div",{staticClass:"edit",on:{click:t.exit}},[t._v("退出")])])]):t._e()])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"user"},[e("i",{staticClass:"icon iconfont icon-icon"}),e("i",{staticClass:"icon iconfont icon-sanjiaoxing-down"})])}]},w={name:"pageApp",data:function(){return{}},computed:{},components:{HeaderBar:s("VU/8")(b,C,!1,function(t){s("P8Lu")},"data-v-d62dc452",null).exports},methods:{}},y={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("HeaderBar"),this._v(" "),e("div",{staticClass:"content"},[e("router-view")],1)],1)},staticRenderFns:[]},k=s("VU/8")(w,y,!1,function(t){s("RTP8")},"data-v-adefd882",null).exports,x={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"con"},[e("iframe",{attrs:{src:"https://zhu18.github.io/visualcontrols/#/map3d/debug",frameborder:"0",width:"100%",height:"100%;"}})])}]},$=(s("VU/8")({name:"index",data:function(){return{}},components:{},created:function(){},mounted:function(){this.init()},methods:{init:function(){this.$store.dispatch("setCurrMenu",{flag:"index"})}}},x,!1,function(t){s("wbj3")},"data-v-1edff813",null).exports,s("Gu7T")),j=s.n($),I=s("HMpe"),L={name:"operate",props:["options"],data:function(){return{}},computed:o()({},Object(c.b)({isLogin:"getIsLogin"})),methods:{add:function(){this.isLogin?this.$emit("handleAdd"):this.$store.dispatch("setLoginDialogState",!0)}}},P={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"toolbar"},[e("div",{staticClass:"operate"},[this._v("\n    操作：\n    "),this.options.isAdd?e("div",{staticClass:"add"},[e("i",{staticClass:"icon iconfont icon-tianjia",on:{click:this.add}})]):this._e()]),this._v(" "),this.options.isShowRecordTotal?e("div",{staticClass:"chart-count"},[this._v("\n    总共"),e("span",[this._v(this._s(this.options.recordTotal))]),this._v("个图表\n  ")]):this._e()])},staticRenderFns:[]},S=s("VU/8")(L,P,!1,function(t){s("mwIG")},"data-v-b3fab394",null).exports,F={name:"indexList",props:["charts","isChange"],data:function(){return{imgs:[]}},computed:o()({},Object(c.b)({user:"getUser",isLogin:"getIsLogin"})),mounted:function(){},methods:{lazyImg:function(t){var e=this;this.imgs.push(t),this.loadImgs(),window.onscroll=function(){return e.loadImgs()}},loadImgs:function(){var t=this,e=window.scrollY,s=window.innerHeight,i=void 0;this.imgs.map(function(n,a){if(n){var r=n.getBoundingClientRect(),o=n.ownerDocument.defaultView;i=r.top+o.pageYOffset-e,(n.offsetWidth||n.offsetHeight||n.getClientRects().length)&&i>=0&&i<s&&(t.setBase64(n),t.imgs[a]=null)}})},setBase64:function(t){this.api.get("/chart/getBase64",{id:t.getAttribute("id")}).then(function(e){t.className+=" loaded",e.status&&e.result.base64?t.src=e.result.base64:t.src="/static/nopic.png"})},detail:function(t){window.open("/detail/"+t)},edit:function(t){this.$emit("editChart",t)},del:function(t){var e=this;this.api.post("/chart/del",{_id:t}).then(function(t){e.$message({showClose:!0,message:t.status?"删除成功":"删除失败",type:t.status?"success":"error"}),t.status&&e.$emit("delChart",!0)})},search:function(t){this.$router.push({path:"/chart/search",query:{u:t._id}})},getDateDiff:function(t){"string"==typeof t&&(t=this.getDate(t));var e=(new Date).getTime()-t,s=e/2592e6,i=e/6048e5,n=e/864e5,a=e/36e5,r=e/6e4;return s>=1?parseInt(s)+"个月前":i>=1?parseInt(i)+"周前":n>=1?parseInt(n)+"天前":a>=1?parseInt(a)+"个小时前":r>=1?parseInt(r)+"分钟前":"刚刚"},getDate:function(t){var e=t.toString();return e=e.replace("/-/g","/"),e=e.replace("T"," "),new Date(e).getTime()}},watch:{isChange:function(){this.imgs=[]}},directives:{lazy:{bind:function(t,e){e.value(t)}}}},D={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"div"},t._l(t.charts,function(e){return t.charts.length>0?s("div",{staticClass:"chartItem"},[s("div",{staticClass:"img",on:{click:function(s){t.detail(e._id)}}},[s("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.lazyImg,expression:"lazyImg"}],ref:e._id,refInFor:!0,staticClass:"lazy",attrs:{id:e._id,src:"/static/nopic.png"}})]),t._v(" "),s("div",{staticClass:"ctx"},[s("h3",[s("a",{attrs:{title:e.name},on:{click:function(s){t.detail(e._id)}}},[t._v(t._s(e.name))])]),t._v(" "),s("span",{staticClass:"item user",attrs:{title:e.user.disName||e.user.name},on:{click:function(s){s.stopPropagation(),t.search(e.user)}}},[s("i",{staticClass:"icon iconfont icon-robot"}),t._v(" "+t._s(e.user.disName||e.user.name))]),t._v(" "),s("span",{class:["item te-icon",e.category],attrs:{title:e.category+"图表"}}),t._v(" "),s("span",{staticClass:"item date",attrs:{title:e.createDate}},[t._v(t._s(t.getDateDiff(e.updateDate)))])]),t._v(" "),t.isLogin&&(e.user==t.user._id||e.project&&t.user._id==e.project.manager)?[s("div",{staticClass:"op edit edit-active",on:{click:function(s){s.stopPropagation(),t.edit(e)}}},[t._v("编辑")]),t._v(" "),s("div",{staticClass:"op cls cls-active",on:{click:function(s){s.stopPropagation(),t.del(e._id)}}},[t._v("删除")])]:[s("div",{staticClass:"op edit",attrs:{title:"无操作权限"}},[t._v("编辑")]),t._v(" "),s("div",{staticClass:"op cls",attrs:{title:"无操作权限"}},[t._v("删除")])]],2):t._e()}))},staticRenderFns:[]},E=s("VU/8")(F,D,!1,function(t){s("ogq9")},"data-v-55c9a1b9",null).exports,R={name:"add",props:["chartTypes","chart"],data:function(){return{popover:{v1:!1,v2:!1}}},computed:o()({},Object(c.b)({user:"getUser",isLogin:"getIsLogin",projects:"getProjects"})),mounted:function(){},methods:{save:function(){var t=this;if(this.chart.name?this.chart.project||(this.popover.v2=!0):this.popover.v1=!0,this.initPopover(),!this.popover.v1&&!this.popover.v2){var e=!this.chart._id;e&&(this.chart.user=this.user._id),this.api.post(e?"/chart/add":"/chart/update",this.chart).then(function(e){t.$message({showClose:!0,message:e.status?"操作成功":"操作失败",type:e.status?"success":"error"}),e.status&&t.$emit("reloadCharts",!0)})}},close:function(){this.$emit("reloadCharts")},selChartType:function(t){this.chart.chartType=t},initPopover:function(){var t=this;setTimeout(function(){t.popover.v1=!1,t.popover.v2=!1},2e3)}}},T={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("el-form",{ref:"chart",attrs:{model:t.chart,"label-width":"80px"}},[s("el-form-item",{attrs:{label:"名称"}},[s("el-popover",{ref:"popover1",attrs:{placement:"top-start",trigger:"manual"},model:{value:t.popover.v1,callback:function(e){t.$set(t.popover,"v1",e)},expression:"popover.v1"}},[s("p",[t._v("请输入名称")])]),t._v(" "),s("el-input",{directives:[{name:"popover",rawName:"v-popover:popover1",arg:"popover1"}],model:{value:t.chart.name,callback:function(e){t.$set(t.chart,"name",e)},expression:"chart.name"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"项目"}},[s("el-popover",{ref:"popover2",attrs:{placement:"top-start",trigger:"manual"},model:{value:t.popover.v2,callback:function(e){t.$set(t.popover,"v2",e)},expression:"popover.v2"}},[s("p",[t._v("请选择项目")])]),t._v(" "),s("el-select",{directives:[{name:"popover",rawName:"v-popover:popover2",arg:"popover2"}],attrs:{filterable:"",placeholder:"请选择所属项目"},model:{value:t.chart.project,callback:function(e){t.$set(t.chart,"project",e)},expression:"chart.project"}},t._l(t.projects,function(t){return s("el-option",{key:t._id,attrs:{label:t.name,value:t._id}})}))],1),t._v(" "),s("el-form-item",{attrs:{label:"类别"}},[s("el-radio-group",{model:{value:t.chart.category,callback:function(e){t.$set(t.chart,"category",e)},expression:"chart.category"}},[s("el-radio",{attrs:{label:"Echarts"}}),t._v(" "),s("el-radio",{attrs:{label:"D3"}}),t._v(" "),s("el-radio",{attrs:{label:"ThreeJS"}})],1)],1),t._v(" "),s("el-form-item",{attrs:{label:"类型"}},[s("div",{staticClass:"chartTypes"},t._l(t.chartTypes,function(e){return s("span",{class:["item",e._id==t.chart.chartType?"active":""],on:{click:function(s){t.selChartType(e._id)}}},[s("i",{class:["icon","iconfont",e.icon]}),s("label",[t._v(t._s(e.name))])])}))]),t._v(" "),s("el-form-item",{attrs:{label:"备注"}},[s("el-input",{attrs:{type:"textarea"},model:{value:t.chart.remark,callback:function(e){t.$set(t.chart,"remark",e)},expression:"chart.remark"}})],1),t._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("保存")]),t._v(" "),s("el-button",{on:{click:t.close}},[t._v("关闭")])],1)],1)],1)},staticRenderFns:[]},U=s("VU/8")(R,T,!1,function(t){s("2Gej")},"data-v-3b712dc7",null).exports,M=s("zL8q"),z=s.n(M),A={name:"index",data:function(){return{loading:!1,isChange:!0,nav:{isShow:!0,type:"type",chartTypes:[],items:[]},curr:{navId:"",typeId:"",proId:"",chart:{},charts:[]},dialog:{visible:!1,title:""},pagination:{scrollDisable:!1,size:50,index:0,total:0},toolbar:{isAdd:!0,isShowRecordTotal:!0,recordTotal:0}}},computed:o()({},Object(c.b)({user:"getUser",projects:"getProjects"})),components:{ChartList:E,AddChart:U,ToolBar:S},mounted:function(){this.nav.type=this.$route.params.type,this.$store.dispatch("setCurrMenu",{flag:"chart"+this.nav.type});new I.a("#container",{wheelSpeed:.5});this.init(),this.scrollEvent()},methods:{init:function(){"search"==this.nav.type&&(this.nav.isShow=!1,this.getCharts()),this.getChartTypes(),this.getProjects()},scrollEvent:function(){var t=this;window.addEventListener("scroll",function(){document.documentElement.scrollTop+window.innerHeight>=document.body.offsetHeight&&(t.pagination.scrollDisable||(t.pagination.scrollDisable=!0,t.pagination.index++,t.loadCharts()))})},getProjects:function(){this.projects.length>0&&(this.curr.proId=this.projects[0]._id,"pro"==this.nav.type&&(this.nav.items=this.projects,this.getCharts()))},getChartTypes:function(){var t=this;this.api.post("/chartType/find",{}).then(function(e){e.status&&(t.nav.chartTypes=e.result,t.curr.typeId=t.nav.chartTypes[0]._id,"type"==t.nav.type&&(t.nav.items=t.nav.chartTypes,t.getCharts()))})},getCharts:function(t){var e=this;t?(this.curr.navId=t,this.curr["pro"==this.nav.type?"proId":"typeId"]=t):this.curr.navId=this.curr["pro"==this.nav.type?"proId":"typeId"];var s=this.getSearchParam();this.curr.charts=[],this.pagination.index=0,this.pagination.scrollDisable=!1,this.toolbar.recordTotal=0,this.isChange=!this.isChange,this.api.post("/chart/count",s).then(function(t){t.status&&(e.pagination.total=t.result,e.toolbar.recordTotal=t.result,e.loadCharts())})},getSearchParam:function(){var t=this.$route.query;return"pro"==this.nav.type?{project:this.curr.proId}:"type"==this.nav.type?{chartType:this.curr.typeId}:t.u?{user:t.u}:{keyword:t.q||""}},loadCharts:function(){var t=this;this.loading=!0;var e=this.getSearchParam(),s={pageIndex:this.pagination.index,pageSize:this.pagination.size,chart:e};this.api.post("/chart/find",s).then(function(e){if(e.status){var s;(s=t.curr.charts).push.apply(s,j()(e.result))}(t.pagination.index+1)*t.pagination.size<t.pagination.total?t.pagination.scrollDisable=!1:t.pagination.scrollDisable=!0,t.loading=!1})},addChart:function(){this.reset(),this.dialog.title="添加图表",this.dialog.visible=!0},editChart:function(t){this.curr.chart={_id:t._id,name:t.name,project:t.project._id,category:t.category,chartType:t.chartType._id,remark:t.remark},this.dialog.title="编辑图表",this.dialog.visible=!0},reloadCharts:function(t){this.dialog.visible=!1,t&&this.getCharts()},reset:function(){this.curr.chart={name:"",project:this.curr.proId,category:"Echarts",chartType:this.curr.typeId,remark:""}}},watch:{$route:function(){this.nav.type=this.$route.params.type,this.nav.items="pro"==this.nav.type?this.projects:this.nav.chartTypes,this.nav.isShow="search"!=this.nav.type,this.$store.dispatch("setCurrMenu",{flag:"chart"+this.nav.type}),this.getCharts()},projects:function(){this.getProjects()},"nav.items":function(){var t=document.querySelector("#container");t&&(t.scrollTop=0)}}},N={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{"element-loading-text":"拼命加载中...."}},[t.nav.isShow?s("div",{staticClass:"navigation",attrs:{id:"container"}},t._l(t.nav.items,function(e){return s("a",{class:["projectItem",e._id==t.curr.navId?"active":""],attrs:{title:e.name},on:{click:function(s){t.getCharts(e._id)}}},["type"==t.nav.type?s("i",{class:["icon","iconfont",e.icon]}):t._e(),t._v(t._s(e.name)+"\n      ")])})):t._e(),t._v(" "),s("div",{class:["right-container clearfix",t.nav.isShow?"mar-left180":""]},[s("ToolBar",{attrs:{options:t.toolbar},on:{handleAdd:t.addChart}}),t._v(" "),s("ChartList",{attrs:{charts:t.curr.charts,isChange:t.isChange},on:{editChart:t.editChart,delChart:t.reloadCharts}})],1)]),t._v(" "),s("el-dialog",{attrs:{title:t.dialog.title,visible:t.dialog.visible,width:"60%","lock-scroll":!1},on:{"update:visible":function(e){t.$set(t.dialog,"visible",e)}}},[s("AddChart",{attrs:{chartTypes:t.nav.chartTypes,chart:t.curr.chart},on:{reloadCharts:t.reloadCharts}})],1)],1)},staticRenderFns:[]},V=s("VU/8")(A,N,!1,function(t){s("o0XC")},"data-v-44f7ea82",null).exports,B=s("E5Az"),q=s.n(B),O=(s("4/hK"),s("aX1R"),s("Kk9m"),s("fo6W"),s("Yokd"),s("aGTD"),s("5IAE"),s("8Nur"),s("hKnC"),s("9xLI"),s("PsxY"),s("jQeI"),s("Mixr"),s("aYBQ")),H=s.n(O),W={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"navbar"},[e("div",{staticClass:"logo"},[e("router-link",{attrs:{to:"/"}},[e("i",{staticClass:"icon iconfont icon-icp-acitve-spline"}),e("span",[this._v("charts")])])],1),this._v(" "),e("span",{staticClass:"title"},[this._v(this._s(this.options.title))]),this._v(" "),e("div",{staticClass:"operate"},[this.options.isShowPublish?e("a",{staticClass:"publish",on:{click:this.save}},[e("i",{staticClass:"icon iconfont icon-fabu"}),this._v("发布")]):this._e()])])},staticRenderFns:[]},G=s("VU/8")({name:"HeaderBar",props:["options"],data:function(){return{}},methods:{save:function(){this.$emit("handleCli")}}},W,!1,function(t){s("oma5")},"data-v-67af9eb1",null).exports,Y=s("7nRM"),J=s.n(Y),X={name:"uploadResource",props:["chart","fileList"],data:function(){return{files:[]}},mounted:function(){var t=J()(this.fileList);this.files=t.slice(0)},methods:{uploadSuccess:function(t,e,s){t.status&&this.$emit("upFiles",t.result)},uploadError:function(t,e,s){},beforeAvatarUpload:function(t){return!t||t.size/1024/1024<10||(console.log("上传模板大小不能超过 10MB!"),!1)},removeFile:function(t,e){var s=this,i=t;t.response&&t.response.status&&(i=t.response.result),this.api.post("/file/del",i).then(function(e){if(e.status){var i=0;s.fileList.some(function(e,s){return i=s,e._id==t._id}),i<s.fileList.length&&s.fileList.splice(i,1)}})}}},K={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("el-upload",{staticClass:"upload-demo",attrs:{drag:"",action:"/file/upload",name:"files",accept:".js,.json","file-list":this.files,data:this.chart,onError:this.uploadError,onSuccess:this.uploadSuccess,beforeUpload:this.beforeAvatarUpload,onRemove:this.removeFile,multiple:""}},[e("i",{staticClass:"el-icon-upload"}),this._v(" "),e("div",{staticClass:"el-upload__text"},[this._v("将文件拖到此处，或"),e("em",[this._v("点击上传")])]),this._v(" "),e("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[this._v("只能上传js/json文件")])])],1)},staticRenderFns:[]},Q=s("VU/8")(X,K,!1,function(t){s("lTJv")},"data-v-58cdafe2",null).exports,Z={name:"showChart",props:["chart","flag"],data:function(){return{}},mounted:function(){this.init()},methods:{init:function(){this.loadChart()},loadChart:function(){if(this.chart.code){var t=document.createElement("iframe");t.setAttribute("frameborder","0"),t.setAttribute("id","ifr"),document.getElementById("output").innerHTML="",document.getElementById("output").appendChild(t);var e=t.contentWindow?t.contentWindow:t.contentDocument.document?t.contentDocument.document:t.contentDocument;e.document.open(),e.document.write(this.chart.code);var s=this;e.onload=function(){s.chart&&setTimeout(function(){if("Echarts"==s.chart.category){var t=e.document.getElementsByTagName("canvas")[0];if(!t)return;s.chart.base64=t.toDataURL("image/png")}else{var i=e.document.getElementsByTagName("svg")[0];if(!i)return;var n=(new XMLSerializer).serializeToString(i);s.chart.base64="data:image/svg+xml;base64,"+window.btoa(n)}},500)},e.document.close()}}},watch:{flag:function(t,e){this.loadChart()}}},tt={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{attrs:{id:"output"}})},staticRenderFns:[]},et=s("VU/8")(Z,tt,!1,function(t){s("fXNf")},"data-v-044ba691",null).exports,st={name:"detail",data:function(){return{id:"",chart:{name:"",project:"",category:"",chartType:"",code:"",base64:""},flag:!1,resource:{serverPath:"http://localhost:8086",lib:{Echarts:[{name:"jquery",url:"//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"},{name:"echarts-v3",url:"//echarts.baidu.com/examples/vendors/echarts/echarts.min.js"},{name:"china",url:"//echarts.baidu.com/examples/vendors/echarts/map/js/china.js"},{name:"world",url:"//echarts.baidu.com/examples/vendors/echarts/map/js/world.js"},{name:"echarts-v2",url:"//cdn.bootcss.com/echarts/2.2.7/echarts-all.js"}],D3:[{name:"jquery",url:"//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"},{name:"d3-v3",url:"//d3js.org/d3.v3.min.js"},{name:"d3-v4",url:"//d3js.org/d3.v4.min.js"}],ThreeJS:[]},staticLib:[],dynamicLib:[],dialogVisible:!1},header:{title:"",isShowPublish:!1},cmOptions:{tabSize:4,styleActiveLine:!0,lineNumbers:!0,line:!0,mode:{name:"htmlmixed",tags:{style:[["type",/^text\/(x-)?scss$/,"text/x-scss"],[null,null,"css"]],custom:[[null,null,"customMode"]]},globalVars:!0},lineWrapping:!1,scrollbarStyle:"simple",theme:"default",autoCloseBrackets:!0,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],extraKeys:{"Ctrl-Q":"autocomplete"}}}},computed:o()({},Object(c.b)({user:"getUser",isLogin:"getIsLogin"})),components:{codemirror:B.codemirror,Splitter:H.a,HeaderBar:G,UploadPage:Q,ShowChart:et},mounted:function(){this.init(),this.getResource()},methods:{init:function(){var t=this;this.id=this.$route.params.id,this.api.get("/chart/findById",{id:this.id}).then(function(e){t.chart=e.result,t.header.title=t.chart.name;var s=t.chart.category||"echarts";t.resource.staticLib=t.resource.lib[s],t.chart.code||t.api.get("/static/template-echarts.html").then(function(e){t.chart.code=e}),t.isLogin&&(t.chart.user==t.user._id||t.chart.project&&t.user._id==t.chart.project.manager)&&(t.header.isShowPublish=!0)})},save:function(){var t=this;if(this.user)if(this.id){var e={_id:this.id,base64:this.chart.base64,code:this.chart.code};this.api.post("/chart/update",e).then(function(e){t.$message({showClose:!0,message:e.status?"图表发布成功":"图表发布失败",type:e.status?"success":"error"})})}else this.$message({showClose:!0,message:"未能获取到图表标识",type:"error"});else this.$message({showClose:!0,message:"登录过期，请重新登录",type:"error"})},spResize:function(){},onCmReady:function(t){},onCmFocus:function(t){},onCmCodeChange:function(t){this.chart.code=t,this.flag=!this.flag},getResource:function(){var t=this;this.api.post("/file/find",{chart:this.id}).then(function(e){t.resource.dynamicLib=e.result})},upFiles:function(t){this.resource.dynamicLib.push(t)},uploadResource:function(){this.resource.dialogVisible=!0},run:function(){this.flag=!this.flag},addResource:function(t){var e="";e=/(\.json)/i.test(t)?"<script>\n  $.get('"+t+"', function(data) {\n  });\n<\/script>":"<script type='text/javascript' src='"+t+"'><\/script>",/(<script)/gi.test(this.chart.code)?this.chart.code=this.chart.code.replace(/(<script)/i,e+"\n$1"):/(<\/body>)/gi.test(this.chart.code)?this.chart.code=this.chart.code.replace(/(<\/body>)/i,"$1\n"+e):this.chart.code+=e}}},it={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("HeaderBar",{attrs:{options:t.header},on:{handleCli:t.save}}),t._v(" "),s("Splitter",{attrs:{margin:20},on:{resize:t.spResize}},[s("div",{attrs:{slot:"left-pane"},slot:"left-pane"},[s("div",{staticClass:"control-panel"},[s("div",{staticClass:"left"}),t._v(" "),s("div",{staticClass:"right"},[s("el-dropdown",{attrs:{trigger:"click","hide-on-click":!1}},[s("span",{staticClass:"el-dropdown-link"},[t._v("\n              资源库"),s("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t._v(" "),s("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t._l(t.resource.staticLib,function(e){return s("el-dropdown-item",{key:e.name},[s("a",{on:{click:function(s){t.addResource(e.url)}}},[t._v(t._s(e.url))])])}),t._v(" "),t._l(t.resource.dynamicLib,function(e){return s("el-dropdown-item",{key:e.name},[s("a",{on:{click:function(s){t.addResource(t.resource.serverPath+e.url)}}},[t._v(t._s(t.resource.serverPath)+t._s(e.url))])])}),t._v(" "),s("el-dropdown-item",{attrs:{divided:""}},[s("a",{staticClass:"upfile",on:{click:t.uploadResource}},[t._v("上传文件")])])],2)],1),t._v(" "),s("a",{on:{click:t.run}},[t._v("运行")])],1)]),t._v(" "),s("codemirror",{ref:"myCm",attrs:{value:t.chart.code,options:t.cmOptions},on:{ready:t.onCmReady,focus:t.onCmFocus,input:t.onCmCodeChange}})],1),t._v(" "),s("div",{attrs:{slot:"right-pane"},slot:"right-pane"},[s("ShowChart",{attrs:{chart:t.chart,flag:t.flag}})],1)]),t._v(" "),s("el-dialog",{attrs:{title:"资源管理",visible:t.resource.dialogVisible,width:"700px"},on:{"update:visible":function(e){t.$set(t.resource,"dialogVisible",e)}}},[s("UploadPage",{attrs:{chart:t.chart,fileList:t.resource.dynamicLib},on:{upFiles:t.upFiles}})],1)],1)},staticRenderFns:[]},nt=s("VU/8")(st,it,!1,function(t){s("k86u")},"data-v-d8a697f6",null).exports,at={name:"userInfo",data:function(){return{sex:1}},computed:o()({},Object(c.b)({user:"getUser"})),mounted:function(){this.init()},methods:{init:function(){this.sex=this.user.sex},save:function(){var t=this;this.user.sex=this.sex,this.api.post("/user/update",this.user).then(function(e){t.$message({showClose:!0,message:e.status?"保存成功":"保存失败,请重新操作",type:e.status?"success":"error"}),e.status&&localStorage.setItem("currUser",n()(t.user))})},reset:function(){}}},rt={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container"},[t._m(0),t._v(" "),s("div",{staticClass:"baseinfo"},[s("el-form",{attrs:{model:t.user,"label-width":"120px"}},[s("el-form-item",{attrs:{label:"用户名"}},[s("el-input",{attrs:{disabled:""},model:{value:t.user.name,callback:function(e){t.$set(t.user,"name",e)},expression:"user.name"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"电话"}},[s("el-input",{model:{value:t.user.tel,callback:function(e){t.$set(t.user,"tel",e)},expression:"user.tel"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"邮箱"}},[s("el-input",{model:{value:t.user.email,callback:function(e){t.$set(t.user,"email",e)},expression:"user.email"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"显示名"}},[s("el-input",{model:{value:t.user.disName,callback:function(e){t.$set(t.user,"disName",e)},expression:"user.disName"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"性别"}},[s("el-radio-group",{model:{value:t.sex,callback:function(e){t.sex=e},expression:"sex"}},[s("el-radio",{attrs:{label:1}},[t._v("男")]),t._v(" "),s("el-radio",{attrs:{label:0}},[t._v("女")])],1)],1),t._v(" "),s("el-form-item",{attrs:{label:"备注"}},[s("el-input",{attrs:{type:"textarea"},model:{value:t.user.remark,callback:function(e){t.$set(t.user,"remark",e)},expression:"user.remark"}})],1),t._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("保存")])],1)],1)],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title clearfix"},[e("h2",[e("i",{staticClass:"icon iconfont icon-icon-yuanxk"}),this._v("基本信息")])])}]},ot=s("VU/8")(at,rt,!1,function(t){s("7WbU")},"data-v-4e68970a",null).exports,ct={name:"userInfo",data:function(){var t=this;return{ruleForm:{oldPwd:"",pwd:"",checkPwd:""},rules:{oldPwd:[{validator:function(e,s,i){""===s?i(new Error("请输入原始密码")):t.api.post("/user/find",{_id:t.user._id,pwd:s}).then(function(t){t.result?i():i(new Error("原始密码错误，请重新输入"))})},trigger:"blur"}],pwd:[{validator:function(t,e,s){""===e?s(new Error("请输入密码")):e.length<6?s(new Error("请设置不少于6为的密码长度")):s()},trigger:"blur"}],checkPwd:[{validator:function(e,s,i){""===s?i(new Error("请再次输入密码")):s!==t.ruleForm.pwd?i(new Error("两次输入密码不一致!")):i()},trigger:"blur"}]}}},computed:o()({},Object(c.b)({user:"getUser"})),mounted:function(){this.init()},methods:{init:function(){},change:function(){var t=this;this.$refs.ruleForm.validate(function(e){if(!e)return console.log("error submit!!"),!1;var s={_id:t.user._id,pwd:t.ruleForm.pwd};t.api.post("/user/update",s).then(function(e){t.$message({showClose:!0,message:e.status?"密码修改成功":"修改失败,请重新操作",type:e.status?"success":"error"})})})},reset:function(){}}},lt={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container"},[t._m(0),t._v(" "),s("div",{staticClass:"baseinfo"},[s("el-form",{ref:"ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"label-width":"120px"}},[s("el-form-item",{attrs:{label:"用户名"}},[s("el-input",{attrs:{disabled:""},model:{value:t.user.name,callback:function(e){t.$set(t.user,"name",e)},expression:"user.name"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"原始密码",prop:"oldPwd"}},[s("el-input",{attrs:{type:"password"},model:{value:t.ruleForm.oldPwd,callback:function(e){t.$set(t.ruleForm,"oldPwd",e)},expression:"ruleForm.oldPwd"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"新密码",prop:"pwd"}},[s("el-input",{attrs:{type:"password"},model:{value:t.ruleForm.pwd,callback:function(e){t.$set(t.ruleForm,"pwd",e)},expression:"ruleForm.pwd"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"确认密码",prop:"checkPwd"}},[s("el-input",{attrs:{type:"password"},model:{value:t.ruleForm.checkPwd,callback:function(e){t.$set(t.ruleForm,"checkPwd",e)},expression:"ruleForm.checkPwd"}})],1),t._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:t.change}},[t._v("修改")])],1)],1)],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title clearfix"},[e("h2",[e("i",{staticClass:"icon iconfont icon-mima1"}),this._v("修改密码")])])}]},ut=s("VU/8")(ct,lt,!1,function(t){s("pnFm")},"data-v-2478d6d9",null).exports,dt={name:"add",props:["proItem"],computed:o()({},Object(c.b)({user:"getUser"})),data:function(){return{popover:{v1:!1,v2:!1}}},mounted:function(){},methods:{save:function(){var t=this;if(this.proItem.name?this.proItem||(this.popover.v2=!0):this.popover.v1=!0,this.initPopover(),!this.popover.v1&&!this.popover.v2){var e=!this.proItem._id;e&&(this.proItem.manager=this.user),this.api.post(e?"/project/add":"/project/edit",this.proItem).then(function(e){t.$message({showClose:!0,message:e.status?"操作成功":"操作失败",type:e.status?"success":"error"}),e.status&&t.$emit("reloadProject",!0)})}},close:function(){this.$emit("reloadProject")},initPopover:function(){var t=this;setTimeout(function(){t.popover.v1=!1,t.popover.v2=!1},2e3)}}},ht={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("el-form",{ref:"proItem",attrs:{model:t.proItem,"label-width":"80px"}},[s("el-form-item",{attrs:{label:"名称"}},[s("el-popover",{ref:"popover1",attrs:{placement:"top-start",trigger:"manual"},model:{value:t.popover.v1,callback:function(e){t.$set(t.popover,"v1",e)},expression:"popover.v1"}},[s("p",[t._v("请输入名称")])]),t._v(" "),s("el-input",{directives:[{name:"popover",rawName:"v-popover:popover1",arg:"popover1"}],model:{value:t.proItem.name,callback:function(e){t.$set(t.proItem,"name",e)},expression:"proItem.name"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"备注"}},[s("el-input",{attrs:{type:"textarea"},model:{value:t.proItem.remark,callback:function(e){t.$set(t.proItem,"remark",e)},expression:"proItem.remark"}})],1),t._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("保存")]),t._v(" "),s("el-button",{on:{click:t.close}},[t._v("关闭")])],1)],1)],1)},staticRenderFns:[]},pt=s("VU/8")(dt,ht,!1,function(t){s("tF7m")},"data-v-156b2096",null).exports,mt={name:"autocomplete",props:["project"],data:function(){return{isActive:!1}},computed:o()({},Object(c.b)({user:"getUser"})),methods:{showAddInput:function(){this.isActive=!0},querySearchAsync:function(t,e){t&&this.api.get("/user/find2",{keyword:t}).then(function(t){0==t.result.length?e([{name:"请更换关键字",_id:-1}]):e(t.result)})},handleSelect:function(t){var e=this;if(t&&-1!=t._id){var s=this.project;s.members||(s.members=[]);s.members.some(function(e){return e._id==t._id})||(s.members.push(t),this.api.post("/project/edit",s).then(function(t){t.status||e.$message({showClose:!0,message:"添加失败，请刷新列表",type:"error"})}))}}}},ft={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{class:["add-member",this.isActive?"active":""]},[e("i",{staticClass:"icon iconfont icon-tianjiakehu",attrs:{title:"添加成员"},on:{click:this.showAddInput}}),this._v(" "),e("el-autocomplete",{attrs:{size:"mini","fetch-suggestions":this.querySearchAsync,"trigger-on-focus":!1,"select-when-unmatched":!1,valueKey:"name",placeholder:"请输入用户名...."},on:{select:this.handleSelect}})],1)},staticRenderFns:[]},vt=s("VU/8")(mt,ft,!1,function(t){s("qmGa")},"data-v-ed03b24e",null).exports,gt={name:"index",data:function(){return{loading:!1,pagination:{index:0,size:10,total:0},changePage:{prev:"上一页",next:"下一页"},proList:[],proRelChart:[],dialog:{visible:!1,title:""},proItem:[]}},computed:o()({},Object(c.b)({user:"getUser"})),components:{AddProject:pt,Autocomplete:vt},mounted:function(){this.init()},methods:{init:function(){this.getProRelChartCount()},getProRelChartCount:function(){var t=this;this.loading=!0,this.api.get("/project/chartCount").then(function(e){e.status&&(t.proRelChart=e.result),t.getProCount()})},getProCount:function(){var t=this;this.api.get("/project/count",{userId:this.user._id}).then(function(e){e.status&&(t.pagination.total=e.result),e.result||(t.loading=!1)})},getProjects:function(){var t=this,e={pageIndex:this.pagination.index-1,pageSize:this.pagination.size,userId:this.user._id};this.api.post("/project/findByUser",e).then(function(e){e.status&&(t.proList=e.result),t.loading=!1})},getChartCount:function(t){var e=void 0;return this.proRelChart.some(function(s,i,n){if(s._id==t)return e=s,!0}),e?e.count:"0"},addProject:function(){this.reset(),this.dialog.title="添加图表",this.dialog.visible=!0},handleEdit:function(t){this.proItem={_id:t._id,name:t.name,createDate:t.createDate,remark:t.remark},this.dialog.title="编辑项目",this.dialog.visible=!0},handleDelete:function(t){var e=this;this.getChartCount(t)>0?this.$alert("项目下存在图表，请先移除图表","提示",{confirmButtonText:"确定"}):this.api.post("/project/del",{_id:t}).then(function(t){e.$message({showClose:!0,message:t.status?"删除成功":"删除失败",type:t.status?"success":"error"}),e.reload()})},handleSizeChange:function(t){this.pagination.size=t,this.getProjects()},handleCurrentChange:function(t){this.pagination.index=t,this.getProjects()},removeMember:function(t,e,s){var i=this;e.members.splice(t,1),this.api.post("/project/edit",e).then(function(t){t.status?s&&i.reload():i.$message({showClose:!0,message:"操作失败，请刷新页面",type:"error"})})},reload:function(){this.dialog.visible=!1,this.pagination.index=0,this.getProRelChartCount(),l.setProjects(this,this.user._id)},reset:function(){this.proItem={name:"",remark:""}}},watch:{},filters:{formatDate:function(t){var e=new Date(t);return l.formatDate(e,"yyyy-MM-dd hh:mm")}}},_t={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container"},[s("div",{staticClass:"title clearfix"},[t._m(0),t._v(" "),s("div",{staticClass:"operate"},[s("el-button",{attrs:{size:"mini",icon:"icon iconfont icon-tianjia"},on:{click:t.addProject}},[t._v(" 添加")]),t._v(" "),s("el-button",{attrs:{size:"mini",icon:"icon iconfont icon-shuaxin"},on:{click:t.reload}},[t._v(" 刷新")])],1)]),t._v(" "),s("div",{staticClass:"list"},[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.proList}},[s("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("div",{staticClass:"pro-member-con"},[e.row.manager&&e.row.manager._id==t.user._id?s("Autocomplete",{attrs:{project:e.row}}):t._e(),t._v(" "),s("div",[s("label",[t._v("项目成员：")]),t._v(" "),e.row.manager?s("div",{staticClass:"member manager",attrs:{title:"管理员"}},[s("i",{staticClass:"icon iconfont icon-guanliyuan"}),t._v(" "),s("span",[t._v(t._s(e.row.manager.name))])]):t._e(),t._v(" "),t._l(e.row.members,function(i,n){return s("div",{staticClass:"member",attrs:{title:"项目成员"}},[s("i",{staticClass:"icon iconfont icon-yonghu"}),t._v(" "),s("span",[t._v(t._s(i.name))]),t._v(" "),e.row.manager&&e.row.manager._id==t.user._id?s("i",{staticClass:"icon iconfont icon-shanchu1",attrs:{title:"踢出"},on:{click:function(s){t.removeMember(n,e.row)}}}):t.user._id==i._id?s("i",{staticClass:"icon iconfont icon-tuichu1",attrs:{title:"退出"},on:{click:function(s){t.removeMember(n,e.row,!0)}}}):t._e()])})],2)],1)]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"项目名称",prop:"name"}}),t._v(" "),s("el-table-column",{attrs:{label:"创建日期"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n          "+t._s(t._f("formatDate")(e.row.createDate))+"\n        ")]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"我发起的项目"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.manager&&t.user._id==e.row.manager._id?s("i",{staticClass:"icon iconfont icon-duigou"}):t._e()]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"图表数量"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n          "+t._s(t.getChartCount(e.row._id))+"\n        ")]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",{staticClass:"operate",on:{click:function(s){t.handleEdit(e.row)}}},[s("i",{staticClass:"icon iconfont icon-bianji"}),t._v("编辑")]),t._v(" "),e.row.manager&&t.user._id==e.row.manager._id?s("span",{staticClass:"operate",on:{click:function(s){t.handleDelete(e.row._id)}}},[s("i",{staticClass:"icon iconfont icon-shanchu1"}),t._v("删除")]):t._e()]}}])})],1)],1),t._v(" "),s("div",{staticClass:"pagination"},[s("el-pagination",{attrs:{background:"","current-page":t.pagination.index,"page-size":t.pagination.size,layout:"total, prev, pager, next, jumper",total:t.pagination.total,"prev-text":t.changePage.prev,"next-text":t.changePage.next},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),t._v(" "),s("el-dialog",{attrs:{title:t.dialog.title,visible:t.dialog.visible,width:"60%"},on:{"update:visible":function(e){t.$set(t.dialog,"visible",e)}}},[s("AddProject",{attrs:{proItem:t.proItem},on:{reloadProject:t.reload}})],1)],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("h2",[e("i",{staticClass:"icon iconfont icon-msnui-item-list"}),this._v("项目列表")])}]},bt={name:"user",data:function(){return{currentView:"BaseInfo",menus:[{name:"用户基本信息",flag:"BaseInfo",icon:"icon-yonghu1"},{name:"修改密码",flag:"UserPwd",icon:"icon-mima"},{name:"我的项目",flag:"Project",icon:"icon-xiangmu"}]}},components:{BaseInfo:ot,UserPwd:ut,Project:s("VU/8")(gt,_t,!1,function(t){s("o4Rd")},"data-v-b1aaa3de",null).exports},mounted:function(){this.init()},methods:{init:function(){this.$store.dispatch("setCurrMenu",{flag:""})},changeMenu:function(t){this.currentView=t.flag}}},Ct={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"left-bar"},[s("ul",t._l(t.menus,function(e){return s("el-tooltip",{key:e.flag,staticClass:"item",attrs:{effect:"dark",content:e.name,placement:"right"}},[s("li",{class:[t.currentView===e.flag?"active":""],on:{click:function(s){t.changeMenu(e)}}},[s("i",{class:["icon","iconfont",e.icon]})])])}))]),t._v(" "),s("div",{staticClass:"right-page"},[s(t.currentView,{tag:"component"})],1)])},staticRenderFns:[]},wt=s("VU/8")(bt,Ct,!1,function(t){s("JhcL")},"data-v-176ec4d2",null).exports,yt={name:"addUser",data:function(){return{user:{name:"",pwd:"",tel:"",email:"",sex:1,disName:"",remark:""}}},computed:o()({},Object(c.b)({user:"getUser"})),mounted:function(){},methods:{init:function(){},save:function(){var t=this;this.api.post("/user/add",this.user).then(function(e){if(e.status){var s={name:"临时项目",manager:e.result};t.api.post("/project/add",s).then(function(e){t.$message({showClose:!0,message:e.status?"添加成功":"添加失败,请重新操作",type:e.status?"success":"error"})})}else t.$message({showClose:!0,message:"添加失败,请重新操作",type:"error"})})},reset:function(){}}},kt={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container"},[t._m(0),t._v(" "),s("div",{staticClass:"baseinfo"},[s("el-form",{attrs:{model:t.user,"label-width":"120px"}},[s("el-form-item",{attrs:{label:"用户名"}},[s("el-input",{model:{value:t.user.name,callback:function(e){t.$set(t.user,"name",e)},expression:"user.name"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"密码"}},[s("el-input",{model:{value:t.user.pwd,callback:function(e){t.$set(t.user,"pwd",e)},expression:"user.pwd"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"电话"}},[s("el-input",{model:{value:t.user.tel,callback:function(e){t.$set(t.user,"tel",e)},expression:"user.tel"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"邮箱"}},[s("el-input",{model:{value:t.user.email,callback:function(e){t.$set(t.user,"email",e)},expression:"user.email"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"显示名"}},[s("el-input",{model:{value:t.user.disName,callback:function(e){t.$set(t.user,"disName",e)},expression:"user.disName"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"性别"}},[s("el-radio-group",{model:{value:t.sex,callback:function(e){t.sex=e},expression:"sex"}},[s("el-radio",{attrs:{label:1}},[t._v("男")]),t._v(" "),s("el-radio",{attrs:{label:0}},[t._v("女")])],1)],1),t._v(" "),s("el-form-item",{attrs:{label:"备注"}},[s("el-input",{attrs:{type:"textarea"},model:{value:t.user.remark,callback:function(e){t.$set(t.user,"remark",e)},expression:"user.remark"}})],1),t._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("保存")])],1)],1)],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title clearfix"},[e("h2",[e("i",{staticClass:"icon iconfont icon-icon-yuanxk"}),this._v("添加用户")])])}]},xt=s("VU/8")(yt,kt,!1,function(t){s("NkRj")},"data-v-5c30614e",null).exports,$t={data:function(){return{ruleForm:{username:"",password:""},rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]}}},components:{},created:function(){var t=this.getUrlData("code")||"";""!=t&&(console.log("code:",t),this.api.get("/github/user_info",{code:t}).then(function(t){console.log("response:",t)},function(t){}))},methods:{submitForm:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return e.$router.push("/table1"),!1;e.$router.push("/table1")})},githubClick:function(){window.location.href="https://github.com/login/oauth/authorize?client_id=263f45ba8ea1fb856276&redirect_uri=http://localhost:8085/#/login"},getUrlData:function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),s=window.location.search.substr(1).match(e);return null!=s?unescape(s[2]):null}}},jt={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"login"},[s("div",{staticClass:"login-title"},[t._v("图表配置系统")]),t._v(" "),s("div",{staticClass:"login-form"},[s("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"label-width":"0px"}},[s("el-form-item",{attrs:{prop:"username"}},[s("el-input",{attrs:{placeholder:"username"},model:{value:t.ruleForm.username,callback:function(e){t.$set(t.ruleForm,"username",e)},expression:"ruleForm.username"}})],1),t._v(" "),s("el-form-item",{attrs:{prop:"password"}},[s("el-input",{attrs:{type:"password",placeholder:"password"},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.submitForm("ruleForm")}},model:{value:t.ruleForm.password,callback:function(e){t.$set(t.ruleForm,"password",e)},expression:"ruleForm.password"}})],1),t._v(" "),s("div",{staticClass:"login-btn"},[s("el-button",{attrs:{type:"primary"},on:{click:function(e){t.submitForm("ruleForm")}}},[t._v("登录")])],1),t._v(" "),s("i",{staticClass:"icon iconfont icon-github",on:{click:t.githubClick}})],1)],1)])},staticRenderFns:[]},It=s("VU/8")($t,jt,!1,function(t){s("o0X4")},"data-v-0866a3b1",null).exports;a.default.use(v.a);var Lt=new v.a({mode:"history",routes:[{path:"/",name:"PageApp",component:k,children:[{path:"",name:"index",component:V},{path:"chart/:type",name:"chart",component:V},{path:"user",name:"user",component:wt,beforeEnter:function(t,e,s){s()}},{path:"addUser",name:"addUser",component:xt},{path:"login",name:"login",component:It}]},{path:"/detail/:id",name:"Detail",component:nt}]}),Pt=[{name:"类型导航",flag:"charttype",url:"/chart/type",icon:"icon-tubiao"}],St=[{name:"项目导航",flag:"chartpro",url:"/chart/pro",icon:"icon-weibiaoti2010103-copy"}],Ft={state:{menus:Pt,currMenu:Pt[0]},mutations:{setCurrMenu:function(t,e){t.currMenu=e},setMenus:function(t,e){t.menus=e}},actions:{setCurrMenu:function(t,e){t.commit("setCurrMenu",e)},setMenus:function(t,e){t.commit("setMenus",e?[].concat(j()(Pt),j()(St)):Pt)}},getters:{getCurrMenu:function(t){return t.currMenu},getMenus:function(t){return t.menus}}},Dt={state:{isLogin:!1,showLoginDialog:!1,user:null},mutations:{setLoginDialogState:function(t,e){t.showLoginDialog=e},setIsLogin:function(t,e){t.isLogin=e},setUser:function(t,e){t.user=e}},actions:{setLoginDialogState:function(t,e){t.commit("setLoginDialogState",e)},setIsLogin:function(t,e){t.commit("setIsLogin",e)},setUser:function(t,e){t.commit("setUser",e),t.commit("setIsLogin",!!e)}},getters:{getIsShowLoginDialog:function(t){return t.showLoginDialog},getIsLogin:function(t){return t.isLogin},getUser:function(t){return t.user&&delete t.user.pwd,t.user},getTestNums:function(t){return t.testNums}}},Et={state:{projects:[],types:[]},mutations:{setProjects:function(t,e){t.projects=e},setTypes:function(t,e){t.types=e}},actions:{setProjects:function(t,e){t.commit("setProjects",e)},setTypes:function(t,e){context.commit("setTypes",e)}},getters:{getProjects:function(t){return t.projects},getTypes:function(t){return t.types}}};a.default.use(c.a);var Rt=new c.a.Store({modules:{menu:Ft,user:Dt,chart:Et},strict:!1}),Tt=s("//Fk"),Ut=s.n(Tt),Mt=s("mtWM"),zt=s.n(Mt);zt.a.defaults.timeout=5e4,zt.a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=UTF-8";var At=zt.a.create({}),Nt={post:function(t,e){return new Ut.a(function(s,i){At.post(""+t,e).then(function(t){s(t.data)}).catch(function(t){i(t)})})},get:function(t,e){return new Ut.a(function(s,i){At.get(""+t,{params:e}).then(function(t){s(t.data)}).catch(function(t){i(t)})})}};s("2bHb"),s("tvR6"),s("m5D7"),s("991W"),s("oikB");a.default.config.productionTip=!1,a.default.prototype.api=Nt,a.default.use(z.a),a.default.use(q.a),new a.default({el:"#app",router:Lt,store:Rt,created:function(){var t=this,e=localStorage.getItem("currUser");if(e){var s=JSON.parse(e);l.setLoginStore(this,s)}else{var i=l.getUrlData("code")||"";if(!i)return;Nt.get("/github/user_info",{code:i}).then(function(e){if(e.status){var s=e.result;Nt.post("/user/github_login",{login:s.login,name:s.name,email:s.email}).then(function(e){e.status&&(localStorage.setItem("currUser",n()(e.result)),l.setLoginStore(t,e.result)),l.message(t,e.status?"success":"error",e.status?"登录成功":"登录失败")})}else l.message(t,"error",e.result.msg)})}},render:function(t){return t(f)}})},NkRj:function(t,e){},P8Lu:function(t,e){},PsxY:function(t,e){},RTP8:function(t,e){},Yokd:function(t,e){},fXNf:function(t,e){},k86u:function(t,e){},lTJv:function(t,e){},m5D7:function(t,e){},mwIG:function(t,e){},o0X4:function(t,e){},o0XC:function(t,e){},o4Rd:function(t,e){},ogq9:function(t,e){},oikB:function(t,e){},oma5:function(t,e){},pQID:function(t,e){},pnFm:function(t,e){},qmGa:function(t,e){},tF7m:function(t,e){},tvR6:function(t,e){},wbj3:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.07c7efbe4cfa57ff5f60.js.map